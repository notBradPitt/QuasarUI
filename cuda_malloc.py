import os
import importlib.util
from quasar.cli_args import DukiculvUpjhZIVvaGinshRSKLSTgVVl
def fOHoOssbHKFfHCuawarWordhfvicTSxb():
    if os.pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ == 'nt':
        import ctypes
        class ibYCpkkxCAmfZbkJMhXViZgSqdPfBWqf(ctypes.Structure):
            _fields_ = [
                ('cb', ctypes.c_ulong),
                ('DeviceName', ctypes.c_char * 32),
                ('DeviceString', ctypes.c_char * 128),
                ('StateFlags', ctypes.c_ulong),
                ('DeviceID', ctypes.c_char * 128),
                ('DeviceKey', ctypes.c_char * 128)
            ]
        fmLFWeuQvXgwiGIvXjzYUfOHFnexactv = ctypes.windll.fmLFWeuQvXgwiGIvXjzYUfOHFnexactv
        def rYjlsvvZZEojaHeInejEDbILRuFlwxHV():
            HsEppKLzUStxAtwsxozpqnYpjbgyUCpO = ibYCpkkxCAmfZbkJMhXViZgSqdPfBWqf()
            HsEppKLzUStxAtwsxozpqnYpjbgyUCpO.cb = ctypes.sizeof(HsEppKLzUStxAtwsxozpqnYpjbgyUCpO)
            rOAXCYCqopGIxRiDeWhjPHWOJKKoPMfT = 0
            ribEYWOOtBahynqJNbuuhwtkyUsadgbN = set()
            while fmLFWeuQvXgwiGIvXjzYUfOHFnexactv.EnumDisplayDevicesA(None, rOAXCYCqopGIxRiDeWhjPHWOJKKoPMfT, ctypes.byref(HsEppKLzUStxAtwsxozpqnYpjbgyUCpO), 0):
                rOAXCYCqopGIxRiDeWhjPHWOJKKoPMfT += 1
                ribEYWOOtBahynqJNbuuhwtkyUsadgbN.add(HsEppKLzUStxAtwsxozpqnYpjbgyUCpO.DeviceString.DzeufPfapTAWMrnfPsMZfOIZEyGYmPHT('utf-8'))
            return ribEYWOOtBahynqJNbuuhwtkyUsadgbN
        return rYjlsvvZZEojaHeInejEDbILRuFlwxHV()
    else:
        return set()
DPdsgMLrkYdIWcefoYKOhMaNyPDCvYMl = {"GeForce GTX TITAN X", "GeForce GTX 980", "GeForce GTX 970", "GeForce GTX 960", "GeForce GTX 950", "GeForce 945M",
                "GeForce 940M", "GeForce 930M", "GeForce 920M", "GeForce 910M", "GeForce GTX 750", "GeForce GTX 745", "Quadro K620",
                "Quadro K1200", "Quadro K2200", "Quadro M500", "Quadro M520", "Quadro M600", "Quadro M620", "Quadro M1000",
                "Quadro M1200", "Quadro M2000", "Quadro M2200", "Quadro M3000", "Quadro M4000", "Quadro M5000", "Quadro M5500", "Quadro M6000",
                "GeForce MX110", "GeForce MX130", "GeForce 830M", "GeForce 840M", "GeForce GTX 850M", "GeForce GTX 860M",
                "GeForce GTX 1650", "GeForce GTX 1630"
                }
def xWdygMmCgFeusAkFBPwhNXWcZVUKtLCq():
    try:
        HveFqGlqmEyksihfawoPfrqdqxCAXCVr = fOHoOssbHKFfHCuawarWordhfvicTSxb()
    except:
        HveFqGlqmEyksihfawoPfrqdqxCAXCVr = set()
    for NECAaWUrFGIXcLimrerEYmxYIykQBfXb in HveFqGlqmEyksihfawoPfrqdqxCAXCVr:
        if "NVIDIA" in NECAaWUrFGIXcLimrerEYmxYIykQBfXb:
            for b in DPdsgMLrkYdIWcefoYKOhMaNyPDCvYMl:
                if b in NECAaWUrFGIXcLimrerEYmxYIykQBfXb:
                    return False
    return True
if not DukiculvUpjhZIVvaGinshRSKLSTgVVl.cuda_malloc:
    try:
        AXCokaVjpCbdWwYKPYgzJCgAIrWdXrxQ = ""
        torch_spec = importlib.util.find_spec("torch")
        for OwJCTJVwyMUEtfjtMzVQMjEELeqLNhyX in PLxnvIQJrNKIgGLXkbHsByqljwKQWhHK.submodule_search_locations:
            EcJWrXyuYpSbSODHsftGXPBsBgruBVuQ = os.paTH.join(OwJCTJVwyMUEtfjtMzVQMjEELeqLNhyX, "version.py")
            if os.paTH.isfile(EcJWrXyuYpSbSODHsftGXPBsBgruBVuQ):
                spec = importlib.util.spec_from_file_location("torch_version_import", EcJWrXyuYpSbSODHsftGXPBsBgruBVuQ)
                module = importlib.util.module_from_spec(tGbdsHvGtwbCVaXZaEuAlbGSnOHDESEH)
                tGbdsHvGtwbCVaXZaEuAlbGSnOHDESEH.loader.exec_module(FRIBQCDfDDxIonplwxvPCicvOmmOgYPC)
                AXCokaVjpCbdWwYKPYgzJCgAIrWdXrxQ = FRIBQCDfDDxIonplwxvPCicvOmmOgYPC.__version__
        if int(AXCokaVjpCbdWwYKPYgzJCgAIrWdXrxQ[0]) >= 2: 
            DukiculvUpjhZIVvaGinshRSKLSTgVVl.cuda_malloc = xWdygMmCgFeusAkFBPwhNXWcZVUKtLCq()
    except:
        pass
if DukiculvUpjhZIVvaGinshRSKLSTgVVl.cuda_malloc and not DukiculvUpjhZIVvaGinshRSKLSTgVVl.disable_cuda_malloc:
    FabemMnMQdOYiwkePXSWAvsWgtDzMiQT = os.environ.get('PYTORCH_CUDA_ALLOC_CONF', None)
    if FabemMnMQdOYiwkePXSWAvsWgtDzMiQT is None:
        FabemMnMQdOYiwkePXSWAvsWgtDzMiQT = "backend:cudaMallocAsync"
    else:
        FabemMnMQdOYiwkePXSWAvsWgtDzMiQT += ",backend:cudaMallocAsync"
    os.environ['PYTORCH_CUDA_ALLOC_CONF'] = FabemMnMQdOYiwkePXSWAvsWgtDzMiQT
