import torch
import numpy as np
from tqdm import tqdm
from quasar.ldm.modules.diffusionmodules.util import vARPohLnkqbmEgaTgkzsKrKSnRlVAXsG, ydGLHegofJxILoEQvdIngtXoioplZMrS, LrAizKrQgKBxXFjYQZHueeWsViuvAXJp, uECnTnBCuBqbDgSNRAiUiBKHNFFLIvnZ
class ssNFVfoMRtNHTsZhYRkqXDWbhUDSsDKt(object):
    def __init__(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM, HtnYKlBDuwwBEVdTVKsUENSQHeXnhZXs="linear", fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc=torch.fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc("cuda"), **kwargs):
        super().__init__()
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM = VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ddpm_num_timesteps = VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.num_timesteps
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.HtnYKlBDuwwBEVdTVKsUENSQHeXnhZXs = HtnYKlBDuwwBEVdTVKsUENSQHeXnhZXs
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc = fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.parameterization = kwargs.get("parameterization", "eps")
    def BpOtVuSttURsCNYELWmrxpBkqOPYBBlj(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ, jXgWCEykFJZnOJknbIlhJGCSQwytwtJP):
        if type(jXgWCEykFJZnOJknbIlhJGCSQwytwtJP) == torch.Tensor:
            if jXgWCEykFJZnOJknbIlhJGCSQwytwtJP.fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc != rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc:
                jXgWCEykFJZnOJknbIlhJGCSQwytwtJP = jXgWCEykFJZnOJknbIlhJGCSQwytwtJP.float().sAkaPAxVAyVwUBdNgBaxCKHpzBJvSayZ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc)
        setattr(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ, jXgWCEykFJZnOJknbIlhJGCSQwytwtJP)
    def tsMUuSGvjHEShpizgUiHhBUvXzEpNCvO(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, ddim_num_steps, ddim_discretize="uniform", ddim_eta=0., aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS=True):
        xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm = ydGLHegofJxILoEQvdIngtXoioplZMrS(ddim_discr_method=ddim_discretize, num_ddim_timesteps=ddim_num_steps,
                                                  buEvQvwasZgYyUqrxGfyNjTbzvwhzPXv=rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ddpm_num_timesteps,aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS=aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS)
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.tfQEdZlnZQrPbCZTmLaEjmneBMCwydEj(xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm, ddim_eta=ddim_eta, aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS=aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS)
    def tfQEdZlnZQrPbCZTmLaEjmneBMCwydEj(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm, ddim_eta=0., aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS=True):
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm = torch.xPmCFphFKpGMpIsczaSKHmMgRPZzJwla(xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm)
        IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN
        assert IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0] == rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ddpm_num_timesteps, 'alphas have to be defined for each timestep'
        KCffkVYSQPmjfNVfROGpIWQLEwTjwGnQ = lambda NECAaWUrFGIXcLimrerEYmxYIykQBfXb: NECAaWUrFGIXcLimrerEYmxYIykQBfXb.tEcQvpBwXwdqvKxRTLEBROBUyPoodldL().detach().sAkaPAxVAyVwUBdNgBaxCKHpzBJvSayZ(torch.float32).sAkaPAxVAyVwUBdNgBaxCKHpzBJvSayZ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc)
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('betas', KCffkVYSQPmjfNVfROGpIWQLEwTjwGnQ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.aGiatFWLVusbPGSDloFtejqscKjAwtLv))
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('alphas_cumprod', KCffkVYSQPmjfNVfROGpIWQLEwTjwGnQ(IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN))
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('alphas_cumprod_prev', KCffkVYSQPmjfNVfROGpIWQLEwTjwGnQ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.xbuEtLNyZNkLwkSOeiFKOKlofYAdfmXP))
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('sqrt_alphas_cumprod', KCffkVYSQPmjfNVfROGpIWQLEwTjwGnQ(np.sqrt(IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN.cpu())))
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('sqrt_one_minus_alphas_cumprod', KCffkVYSQPmjfNVfROGpIWQLEwTjwGnQ(np.sqrt(1. - IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN.cpu())))
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('log_one_minus_alphas_cumprod', KCffkVYSQPmjfNVfROGpIWQLEwTjwGnQ(np.DJwhOGBaLcOjmXnuwXMXOyhMtknqkKXL(1. - IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN.cpu())))
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('sqrt_recip_alphas_cumprod', KCffkVYSQPmjfNVfROGpIWQLEwTjwGnQ(np.sqrt(1. / IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN.cpu())))
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('sqrt_recipm1_alphas_cumprod', KCffkVYSQPmjfNVfROGpIWQLEwTjwGnQ(np.sqrt(1. / IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN.cpu() - 1)))
        UhwxvNJOIOpYuDYuLFnCTFkDJmQARxHP, QjiFjIOgEuLEafnVNKmbYgjRnHbwNhfp, DaGHMszTvPtphdOZZoBVaYSOdJOBoPWO = vARPohLnkqbmEgaTgkzsKrKSnRlVAXsG(alphacums=IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN.cpu(),
                                                                                   xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm=rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm,
                                                                                   YifKHCfIbeEsuQSFLLpJatOOrlBeQSoO=ddim_eta,aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS=aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS)
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('ddim_sigmas', UhwxvNJOIOpYuDYuLFnCTFkDJmQARxHP)
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('ddim_alphas', QjiFjIOgEuLEafnVNKmbYgjRnHbwNhfp)
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('ddim_alphas_prev', DaGHMszTvPtphdOZZoBVaYSOdJOBoPWO)
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('ddim_sqrt_one_minus_alphas', np.sqrt(1. - QjiFjIOgEuLEafnVNKmbYgjRnHbwNhfp))
        vBPOJjGyjhtkzVvYBwezKxRzAFlVcNcY = ddim_eta * torch.sqrt(
            (1 - rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xbuEtLNyZNkLwkSOeiFKOKlofYAdfmXP) / (1 - rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN) * (
                        1 - rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN / rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xbuEtLNyZNkLwkSOeiFKOKlofYAdfmXP))
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.BpOtVuSttURsCNYELWmrxpBkqOPYBBlj('ddim_sigmas_for_original_num_steps', vBPOJjGyjhtkzVvYBwezKxRzAFlVcNcY)
    @torch.no_grad()
    def puRxokAIMVJpWnSSBEzPeErNyknroJGd(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS,
                      xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm,
                      nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR,
                      FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF=None,
                      zohPmLukTxWcuUrUxAoYaBrbQiOHJrHz=None,
                      UWBsOiqOWfnEhbtaqAOxSotxQUnEXBnc=False,
                      YifKHCfIbeEsuQSFLLpJatOOrlBeQSoO=0.,
                      KHpRlHOzblljQyskecSxzUuWZtneWwta=None,
                      UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP=None,
                      bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT=1.,
                      TMglOjqaCnnmFnxLIYsGatkRARSSDlWE=0.,
                      uwmipcScpDsNgboUJqvoJOCyptukbayF=None,
                      svkqejXkhYfQwesKfbROwkTDdoaLEyDR=None,
                      aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS=True,
                      AqKyQWxyGbtIRJDIpWPDLnPYOoinsvzD=None,
                      LjKqtKRWUcXbjFAGJpBnRulwosodqMRC=100,
                      dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY=1.,
                      yBqylnocrhyQcXxvCQFExhNCxzTGzMKi=None, 
                      qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA=None,
                      hhPtRfENuPromlwRfOtivodeUVYqrBzM=None,
                      QWzJYVQDkweMjacWVWbgCtfshGOIEJoV=None,
                      TlJxtGydipTPezrPlUrxTKACQdhKNgvw=None,
                      GMBlGwQjclEtlzEpOhrgVnqDuOTKMPCK=True,
                      JuYmyPhqAcjxtfxAJDZoeymumtMALkMM=None,
                      DSYgGgUwHlMpKTNDUigXoaeRZJSvXftP=False,
                      **kwargs
                      ):
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.tfQEdZlnZQrPbCZTmLaEjmneBMCwydEj(xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm=xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm, ddim_eta=YifKHCfIbeEsuQSFLLpJatOOrlBeQSoO, aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS=aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS)
        bfpFhSQCEeSgZQwablzNZDcPruUlpnjs, YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.PCGBMLhiWtaQgoaSItnkqldCfmriLjka(nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR, AqKyQWxyGbtIRJDIpWPDLnPYOoinsvzD.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg,
                                                    FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF=FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF,
                                                    zohPmLukTxWcuUrUxAoYaBrbQiOHJrHz=zohPmLukTxWcuUrUxAoYaBrbQiOHJrHz,
                                                    AQYujjqVWCTYeuoWJTDsAGdUIvWSqQDp=UWBsOiqOWfnEhbtaqAOxSotxQUnEXBnc,
                                                    KHpRlHOzblljQyskecSxzUuWZtneWwta=KHpRlHOzblljQyskecSxzUuWZtneWwta, UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP=UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP,
                                                    xkeDFKmtUIMseSAuFHuEApMrMWYQEuue=False,
                                                    TMglOjqaCnnmFnxLIYsGatkRARSSDlWE=TMglOjqaCnnmFnxLIYsGatkRARSSDlWE,
                                                    bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT=bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT,
                                                    uwmipcScpDsNgboUJqvoJOCyptukbayF=uwmipcScpDsNgboUJqvoJOCyptukbayF,
                                                    svkqejXkhYfQwesKfbROwkTDdoaLEyDR=svkqejXkhYfQwesKfbROwkTDdoaLEyDR,
                                                    AqKyQWxyGbtIRJDIpWPDLnPYOoinsvzD=AqKyQWxyGbtIRJDIpWPDLnPYOoinsvzD,
                                                    LjKqtKRWUcXbjFAGJpBnRulwosodqMRC=LjKqtKRWUcXbjFAGJpBnRulwosodqMRC,
                                                    dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY=dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY,
                                                    yBqylnocrhyQcXxvCQFExhNCxzTGzMKi=yBqylnocrhyQcXxvCQFExhNCxzTGzMKi,
                                                    qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA=qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA,
                                                    hhPtRfENuPromlwRfOtivodeUVYqrBzM=hhPtRfENuPromlwRfOtivodeUVYqrBzM,
                                                    QWzJYVQDkweMjacWVWbgCtfshGOIEJoV=QWzJYVQDkweMjacWVWbgCtfshGOIEJoV,
                                                    TlJxtGydipTPezrPlUrxTKACQdhKNgvw=TlJxtGydipTPezrPlUrxTKACQdhKNgvw,
                                                    GMBlGwQjclEtlzEpOhrgVnqDuOTKMPCK=GMBlGwQjclEtlzEpOhrgVnqDuOTKMPCK,
                                                    JuYmyPhqAcjxtfxAJDZoeymumtMALkMM=JuYmyPhqAcjxtfxAJDZoeymumtMALkMM,
                                                    DSYgGgUwHlMpKTNDUigXoaeRZJSvXftP=DSYgGgUwHlMpKTNDUigXoaeRZJSvXftP
                                                    )
        return bfpFhSQCEeSgZQwablzNZDcPruUlpnjs, YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK
    @torch.no_grad()
    def kzeIpaLNSGyUxNmgVakyIZAkNbjmCUjd(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS,
               S,
               batch_size,
               BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg,
               nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR=None,
               FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF=None,
               jLCrVTmoUuFKVxGDtatnwzGzCExmBBAT=None,
               zohPmLukTxWcuUrUxAoYaBrbQiOHJrHz=None,
               UWBsOiqOWfnEhbtaqAOxSotxQUnEXBnc=False,
               YifKHCfIbeEsuQSFLLpJatOOrlBeQSoO=0.,
               KHpRlHOzblljQyskecSxzUuWZtneWwta=None,
               UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP=None,
               bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT=1.,
               TMglOjqaCnnmFnxLIYsGatkRARSSDlWE=0.,
               uwmipcScpDsNgboUJqvoJOCyptukbayF=None,
               svkqejXkhYfQwesKfbROwkTDdoaLEyDR=None,
               aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS=True,
               AqKyQWxyGbtIRJDIpWPDLnPYOoinsvzD=None,
               LjKqtKRWUcXbjFAGJpBnRulwosodqMRC=100,
               dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY=1.,
               yBqylnocrhyQcXxvCQFExhNCxzTGzMKi=None, 
               qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA=None,
               hhPtRfENuPromlwRfOtivodeUVYqrBzM=None,
               **kwargs
               ):
        if nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR is not None:
            if isinstance(nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR, dict):
                TTqHbenEabvvkhoOMkuPsLxjLpCkgUua = nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR[list(nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR.keys())[0]]
                while isinstance(TTqHbenEabvvkhoOMkuPsLxjLpCkgUua, list): TTqHbenEabvvkhoOMkuPsLxjLpCkgUua = TTqHbenEabvvkhoOMkuPsLxjLpCkgUua[0]
                YqPlzmfdeRleEugDYgqhXdTzFrNzlJZs = TTqHbenEabvvkhoOMkuPsLxjLpCkgUua.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0]
                if YqPlzmfdeRleEugDYgqhXdTzFrNzlJZs != batch_size:
                    print(f"Warning: Got {cbs} conditionings but batch-size is {batch_size}")
            elif isinstance(nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR, list):
                for TTqHbenEabvvkhoOMkuPsLxjLpCkgUua in nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR:
                    if TTqHbenEabvvkhoOMkuPsLxjLpCkgUua.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0] != batch_size:
                        print(f"Warning: Got {cbs} conditionings but batch-size is {batch_size}")
            else:
                if nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0] != batch_size:
                    print(f"Warning: Got {conditioning.shape[0]} conditionings but batch-size is {batch_size}")
        rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.tsMUuSGvjHEShpizgUiHhBUvXzEpNCvO(ddim_num_steps=S, ddim_eta=YifKHCfIbeEsuQSFLLpJatOOrlBeQSoO, aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS=aFZoJwWpCnqyOJdcAMLlqOHxDgjPTNCS)
        AHoGYMpsqEtOaZpAamJqoHqHvnlwZSRh, gFdyNTfDqQDeXijWZEnTSFKJXHMWaEiV, vFYBIMOEtqWwjvpBeeDFaIqTrgSbzULJ = BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg
        vqDBJgidQufnKyAltPYRqiKGjmztArDJ = (batch_size, AHoGYMpsqEtOaZpAamJqoHqHvnlwZSRh, gFdyNTfDqQDeXijWZEnTSFKJXHMWaEiV, vFYBIMOEtqWwjvpBeeDFaIqTrgSbzULJ)
        print(f'Data shape for DDIM sampling is {size}, eta {eta}')
        bfpFhSQCEeSgZQwablzNZDcPruUlpnjs, YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.PCGBMLhiWtaQgoaSItnkqldCfmriLjka(nKYmGWBrcYyADcANVAMJtCeHkjgKBdNR, vqDBJgidQufnKyAltPYRqiKGjmztArDJ,
                                                    FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF=FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF,
                                                    zohPmLukTxWcuUrUxAoYaBrbQiOHJrHz=zohPmLukTxWcuUrUxAoYaBrbQiOHJrHz,
                                                    AQYujjqVWCTYeuoWJTDsAGdUIvWSqQDp=UWBsOiqOWfnEhbtaqAOxSotxQUnEXBnc,
                                                    KHpRlHOzblljQyskecSxzUuWZtneWwta=KHpRlHOzblljQyskecSxzUuWZtneWwta, UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP=UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP,
                                                    xkeDFKmtUIMseSAuFHuEApMrMWYQEuue=False,
                                                    TMglOjqaCnnmFnxLIYsGatkRARSSDlWE=TMglOjqaCnnmFnxLIYsGatkRARSSDlWE,
                                                    bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT=bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT,
                                                    uwmipcScpDsNgboUJqvoJOCyptukbayF=uwmipcScpDsNgboUJqvoJOCyptukbayF,
                                                    svkqejXkhYfQwesKfbROwkTDdoaLEyDR=svkqejXkhYfQwesKfbROwkTDdoaLEyDR,
                                                    AqKyQWxyGbtIRJDIpWPDLnPYOoinsvzD=AqKyQWxyGbtIRJDIpWPDLnPYOoinsvzD,
                                                    LjKqtKRWUcXbjFAGJpBnRulwosodqMRC=LjKqtKRWUcXbjFAGJpBnRulwosodqMRC,
                                                    dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY=dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY,
                                                    yBqylnocrhyQcXxvCQFExhNCxzTGzMKi=yBqylnocrhyQcXxvCQFExhNCxzTGzMKi,
                                                    qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA=qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA,
                                                    hhPtRfENuPromlwRfOtivodeUVYqrBzM=hhPtRfENuPromlwRfOtivodeUVYqrBzM,
                                                    QWzJYVQDkweMjacWVWbgCtfshGOIEJoV=None,
                                                    TlJxtGydipTPezrPlUrxTKACQdhKNgvw=None
                                                    )
        return bfpFhSQCEeSgZQwablzNZDcPruUlpnjs, YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK
    def twrldmxqPsdvMdtmZuRtTLKgxMGCJtCm(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, x_start, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD=None):
        if jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD is None:
            jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD = torch.randn_like(x_start)
        return (uECnTnBCuBqbDgSNRAiUiBKHNFFLIvnZ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, x_start.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg) * x_start +
                uECnTnBCuBqbDgSNRAiUiBKHNFFLIvnZ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ayIzJzknKslZlpJwTeDgXUXhvxStZQpi, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, x_start.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg) * jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD)
    @torch.no_grad()
    def PCGBMLhiWtaQgoaSItnkqldCfmriLjka(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, BuoWBAnnMxyvqTGoSTHbQAlvPFWHbuUf, BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg,
                      AqKyQWxyGbtIRJDIpWPDLnPYOoinsvzD=None, xkeDFKmtUIMseSAuFHuEApMrMWYQEuue=False,
                      FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF=None, iaqNqpReXPEdYpNiyUIejEPLCqtbtedA=None, AQYujjqVWCTYeuoWJTDsAGdUIvWSqQDp=False,
                      KHpRlHOzblljQyskecSxzUuWZtneWwta=None, UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP=None, zohPmLukTxWcuUrUxAoYaBrbQiOHJrHz=None, LjKqtKRWUcXbjFAGJpBnRulwosodqMRC=100,
                      bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT=1., TMglOjqaCnnmFnxLIYsGatkRARSSDlWE=0., uwmipcScpDsNgboUJqvoJOCyptukbayF=None, svkqejXkhYfQwesKfbROwkTDdoaLEyDR=None,
                      dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY=1., yBqylnocrhyQcXxvCQFExhNCxzTGzMKi=None, qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA=None,
                      hhPtRfENuPromlwRfOtivodeUVYqrBzM=None, QWzJYVQDkweMjacWVWbgCtfshGOIEJoV=None, TlJxtGydipTPezrPlUrxTKACQdhKNgvw=None, GMBlGwQjclEtlzEpOhrgVnqDuOTKMPCK=True, JuYmyPhqAcjxtfxAJDZoeymumtMALkMM=None, DSYgGgUwHlMpKTNDUigXoaeRZJSvXftP=False):
        fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.aGiatFWLVusbPGSDloFtejqscKjAwtLv.fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc
        b = BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0]
        if AqKyQWxyGbtIRJDIpWPDLnPYOoinsvzD is None:
            UaFpXseNaoqfcpsDACQmTguYDZsTArhs = torch.randn(BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg, fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc=fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc)
        else:
            UaFpXseNaoqfcpsDACQmTguYDZsTArhs = AqKyQWxyGbtIRJDIpWPDLnPYOoinsvzD
        if iaqNqpReXPEdYpNiyUIejEPLCqtbtedA is None:
            iaqNqpReXPEdYpNiyUIejEPLCqtbtedA = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ddpm_num_timesteps if xkeDFKmtUIMseSAuFHuEApMrMWYQEuue else rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm
        elif iaqNqpReXPEdYpNiyUIejEPLCqtbtedA is not None and not xkeDFKmtUIMseSAuFHuEApMrMWYQEuue:
            bvwJphRoDhZxLTgvwjqBZOVhaUawubVw = int(min(iaqNqpReXPEdYpNiyUIejEPLCqtbtedA / rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0], 1) * rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0]) - 1
            iaqNqpReXPEdYpNiyUIejEPLCqtbtedA = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm[:bvwJphRoDhZxLTgvwjqBZOVhaUawubVw]
        YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK = {'x_inter': [UaFpXseNaoqfcpsDACQmTguYDZsTArhs], 'pred_x0': [UaFpXseNaoqfcpsDACQmTguYDZsTArhs]}
        DlZgArthcSzgtzGqfHDDEnFCHSLHQWRM = reversed(range(0,iaqNqpReXPEdYpNiyUIejEPLCqtbtedA)) if xkeDFKmtUIMseSAuFHuEApMrMWYQEuue else iaqNqpReXPEdYpNiyUIejEPLCqtbtedA.hAHyMhlDympwYBnEsaNWPsolDQrxyovx(0)
        TuJjDqKZekSGicNtWVQgPuLDBIQsIxym = iaqNqpReXPEdYpNiyUIejEPLCqtbtedA if xkeDFKmtUIMseSAuFHuEApMrMWYQEuue else iaqNqpReXPEdYpNiyUIejEPLCqtbtedA.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0]
        OphIfvlLGVjDrByPmOZajfCurTkgSmqc = tqdm(DlZgArthcSzgtzGqfHDDEnFCHSLHQWRM[:JuYmyPhqAcjxtfxAJDZoeymumtMALkMM], desc='DDIM Sampler', total=JuYmyPhqAcjxtfxAJDZoeymumtMALkMM, disable=DSYgGgUwHlMpKTNDUigXoaeRZJSvXftP)
        for HCXmerBqIMuTscBONzTGKYapYSxWTYHo, UHmIQCHeLkozPfaktIdEHKdpTVYzCLhe in enumerate(OphIfvlLGVjDrByPmOZajfCurTkgSmqc):
            index = TuJjDqKZekSGicNtWVQgPuLDBIQsIxym - HCXmerBqIMuTscBONzTGKYapYSxWTYHo - 1
            cZfLNeHGLvPreutnrDmWGGyKvtymQVKM = torch.full((b,), UHmIQCHeLkozPfaktIdEHKdpTVYzCLhe, fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc=fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc, DDRQlhrNSGpwTrokWitkZipdfbAqBFxv=torch.long)
            if KHpRlHOzblljQyskecSxzUuWZtneWwta is not None:
                assert UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP is not None
                aUSKPLohyDNFRJMczvWLPVVguMICMoGt = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.twrldmxqPsdvMdtmZuRtTLKgxMGCJtCm(UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP, cZfLNeHGLvPreutnrDmWGGyKvtymQVKM)  
                UaFpXseNaoqfcpsDACQmTguYDZsTArhs = aUSKPLohyDNFRJMczvWLPVVguMICMoGt * KHpRlHOzblljQyskecSxzUuWZtneWwta + (1. - KHpRlHOzblljQyskecSxzUuWZtneWwta) * UaFpXseNaoqfcpsDACQmTguYDZsTArhs
            if hhPtRfENuPromlwRfOtivodeUVYqrBzM is not None:
                assert len(hhPtRfENuPromlwRfOtivodeUVYqrBzM) == len(DlZgArthcSzgtzGqfHDDEnFCHSLHQWRM)
                dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY = hhPtRfENuPromlwRfOtivodeUVYqrBzM[HCXmerBqIMuTscBONzTGKYapYSxWTYHo]
            iaKZglbdZWiaDGkgnGdwdPDQlLdcYnMW = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.iWWXFzGlJRZzfTFBoztQEvdffYEWIlfJ(UaFpXseNaoqfcpsDACQmTguYDZsTArhs, BuoWBAnnMxyvqTGoSTHbQAlvPFWHbuUf, cZfLNeHGLvPreutnrDmWGGyKvtymQVKM, index=index, KtYiLLkMttRIVWgJPwYdrzrduvlLpeov=xkeDFKmtUIMseSAuFHuEApMrMWYQEuue,
                                      AQYujjqVWCTYeuoWJTDsAGdUIvWSqQDp=AQYujjqVWCTYeuoWJTDsAGdUIvWSqQDp, bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT=bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT,
                                      TMglOjqaCnnmFnxLIYsGatkRARSSDlWE=TMglOjqaCnnmFnxLIYsGatkRARSSDlWE, uwmipcScpDsNgboUJqvoJOCyptukbayF=uwmipcScpDsNgboUJqvoJOCyptukbayF,
                                      svkqejXkhYfQwesKfbROwkTDdoaLEyDR=svkqejXkhYfQwesKfbROwkTDdoaLEyDR,
                                      dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY=dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY,
                                      yBqylnocrhyQcXxvCQFExhNCxzTGzMKi=yBqylnocrhyQcXxvCQFExhNCxzTGzMKi,
                                      qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA=qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA, QWzJYVQDkweMjacWVWbgCtfshGOIEJoV=QWzJYVQDkweMjacWVWbgCtfshGOIEJoV, TlJxtGydipTPezrPlUrxTKACQdhKNgvw=TlJxtGydipTPezrPlUrxTKACQdhKNgvw)
            UaFpXseNaoqfcpsDACQmTguYDZsTArhs, OFZIJlADjsdMdYLlZlOCATiBMXflBfif = iaKZglbdZWiaDGkgnGdwdPDQlLdcYnMW
            if FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF: FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF(HCXmerBqIMuTscBONzTGKYapYSxWTYHo)
            if zohPmLukTxWcuUrUxAoYaBrbQiOHJrHz: zohPmLukTxWcuUrUxAoYaBrbQiOHJrHz(OFZIJlADjsdMdYLlZlOCATiBMXflBfif, HCXmerBqIMuTscBONzTGKYapYSxWTYHo)
            if index % LjKqtKRWUcXbjFAGJpBnRulwosodqMRC == 0 or index == TuJjDqKZekSGicNtWVQgPuLDBIQsIxym - 1:
                YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK['x_inter'].append(UaFpXseNaoqfcpsDACQmTguYDZsTArhs)
                YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK['pred_x0'].append(OFZIJlADjsdMdYLlZlOCATiBMXflBfif)
        if GMBlGwQjclEtlzEpOhrgVnqDuOTKMPCK:
            UaFpXseNaoqfcpsDACQmTguYDZsTArhs = OFZIJlADjsdMdYLlZlOCATiBMXflBfif
        else:
            if xkeDFKmtUIMseSAuFHuEApMrMWYQEuue:
                mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj
            else:
                mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj = torch.sqrt(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.QjiFjIOgEuLEafnVNKmbYgjRnHbwNhfp)
            UaFpXseNaoqfcpsDACQmTguYDZsTArhs /= mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj[index - 1]
        return UaFpXseNaoqfcpsDACQmTguYDZsTArhs, YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK
    @torch.no_grad()
    def iWWXFzGlJRZzfTFBoztQEvdffYEWIlfJ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, NECAaWUrFGIXcLimrerEYmxYIykQBfXb, cjHIelcAqVoHWdLcgzuZiBumKNTVADsY, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, index, ILPiaoThrLFONsZievnjpKpnQSXeiZbN=False, KtYiLLkMttRIVWgJPwYdrzrduvlLpeov=False, AQYujjqVWCTYeuoWJTDsAGdUIvWSqQDp=False,
                      bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT=1., TMglOjqaCnnmFnxLIYsGatkRARSSDlWE=0., uwmipcScpDsNgboUJqvoJOCyptukbayF=None, svkqejXkhYfQwesKfbROwkTDdoaLEyDR=None,
                      dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY=1., yBqylnocrhyQcXxvCQFExhNCxzTGzMKi=None,
                      qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA=None, QWzJYVQDkweMjacWVWbgCtfshGOIEJoV=None, TlJxtGydipTPezrPlUrxTKACQdhKNgvw=None):
        b, *_, fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc = *NECAaWUrFGIXcLimrerEYmxYIykQBfXb.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg, NECAaWUrFGIXcLimrerEYmxYIykQBfXb.fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc
        if QWzJYVQDkweMjacWVWbgCtfshGOIEJoV is not None:
            JAGgHAhaDmWtkIWKZFBIaPOFvCpZlupj = QWzJYVQDkweMjacWVWbgCtfshGOIEJoV(NECAaWUrFGIXcLimrerEYmxYIykQBfXb, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, **TlJxtGydipTPezrPlUrxTKACQdhKNgvw)
        elif yBqylnocrhyQcXxvCQFExhNCxzTGzMKi is None or dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY == 1.:
            JAGgHAhaDmWtkIWKZFBIaPOFvCpZlupj = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.MuUKKVVLhPOQUuXCLkPqFOcgOkyciNHd(NECAaWUrFGIXcLimrerEYmxYIykQBfXb, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, cjHIelcAqVoHWdLcgzuZiBumKNTVADsY)
        else:
            pZoNxoVtAYgcFKlLqYosAEKjqMzwRmNs = torch.cat([NECAaWUrFGIXcLimrerEYmxYIykQBfXb] * 2)
            xTGvTRTnrzNeWShiGfMbhVhxqQzWXDWU = torch.cat([XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz] * 2)
            if isinstance(cjHIelcAqVoHWdLcgzuZiBumKNTVADsY, dict):
                assert isinstance(yBqylnocrhyQcXxvCQFExhNCxzTGzMKi, dict)
                dfJKHENBxSWlCdWWoJqBdANPeXpCQuEv = dict()
                for EWOrdNFMIwTeWNNYWAYyRJvhctFfHPqm in cjHIelcAqVoHWdLcgzuZiBumKNTVADsY:
                    if isinstance(cjHIelcAqVoHWdLcgzuZiBumKNTVADsY[EWOrdNFMIwTeWNNYWAYyRJvhctFfHPqm], list):
                        dfJKHENBxSWlCdWWoJqBdANPeXpCQuEv[EWOrdNFMIwTeWNNYWAYyRJvhctFfHPqm] = [torch.cat([
                            yBqylnocrhyQcXxvCQFExhNCxzTGzMKi[EWOrdNFMIwTeWNNYWAYyRJvhctFfHPqm][HCXmerBqIMuTscBONzTGKYapYSxWTYHo],
                            cjHIelcAqVoHWdLcgzuZiBumKNTVADsY[EWOrdNFMIwTeWNNYWAYyRJvhctFfHPqm][HCXmerBqIMuTscBONzTGKYapYSxWTYHo]]) for HCXmerBqIMuTscBONzTGKYapYSxWTYHo in range(len(cjHIelcAqVoHWdLcgzuZiBumKNTVADsY[EWOrdNFMIwTeWNNYWAYyRJvhctFfHPqm]))]
                    else:
                        dfJKHENBxSWlCdWWoJqBdANPeXpCQuEv[EWOrdNFMIwTeWNNYWAYyRJvhctFfHPqm] = torch.cat([
                                yBqylnocrhyQcXxvCQFExhNCxzTGzMKi[EWOrdNFMIwTeWNNYWAYyRJvhctFfHPqm],
                                cjHIelcAqVoHWdLcgzuZiBumKNTVADsY[EWOrdNFMIwTeWNNYWAYyRJvhctFfHPqm]])
            elif isinstance(cjHIelcAqVoHWdLcgzuZiBumKNTVADsY, list):
                dfJKHENBxSWlCdWWoJqBdANPeXpCQuEv = list()
                assert isinstance(yBqylnocrhyQcXxvCQFExhNCxzTGzMKi, list)
                for HCXmerBqIMuTscBONzTGKYapYSxWTYHo in range(len(cjHIelcAqVoHWdLcgzuZiBumKNTVADsY)):
                    dfJKHENBxSWlCdWWoJqBdANPeXpCQuEv.append(torch.cat([yBqylnocrhyQcXxvCQFExhNCxzTGzMKi[HCXmerBqIMuTscBONzTGKYapYSxWTYHo], cjHIelcAqVoHWdLcgzuZiBumKNTVADsY[HCXmerBqIMuTscBONzTGKYapYSxWTYHo]]))
            else:
                dfJKHENBxSWlCdWWoJqBdANPeXpCQuEv = torch.cat([yBqylnocrhyQcXxvCQFExhNCxzTGzMKi, cjHIelcAqVoHWdLcgzuZiBumKNTVADsY])
            oxhTUTUGXxOATitzDmscKZAxtcsZTyvt, AqGOnWoJkvvGXBDAIglnRCxgzScvctsT = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.MuUKKVVLhPOQUuXCLkPqFOcgOkyciNHd(pZoNxoVtAYgcFKlLqYosAEKjqMzwRmNs, xTGvTRTnrzNeWShiGfMbhVhxqQzWXDWU, dfJKHENBxSWlCdWWoJqBdANPeXpCQuEv).ebMwMGDmpDsmyMtCQfGxUhZuVHvTpavF(2)
            JAGgHAhaDmWtkIWKZFBIaPOFvCpZlupj = oxhTUTUGXxOATitzDmscKZAxtcsZTyvt + dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY * (AqGOnWoJkvvGXBDAIglnRCxgzScvctsT - oxhTUTUGXxOATitzDmscKZAxtcsZTyvt)
        if rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.parameterization == "v":
            uBmQzRLOVgunSnlFcnqpUgJOxetSTMeK = uECnTnBCuBqbDgSNRAiUiBKHNFFLIvnZ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, NECAaWUrFGIXcLimrerEYmxYIykQBfXb.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg) * JAGgHAhaDmWtkIWKZFBIaPOFvCpZlupj + uECnTnBCuBqbDgSNRAiUiBKHNFFLIvnZ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ayIzJzknKslZlpJwTeDgXUXhvxStZQpi, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, NECAaWUrFGIXcLimrerEYmxYIykQBfXb.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg) * NECAaWUrFGIXcLimrerEYmxYIykQBfXb
        else:
            uBmQzRLOVgunSnlFcnqpUgJOxetSTMeK = JAGgHAhaDmWtkIWKZFBIaPOFvCpZlupj
        if uwmipcScpDsNgboUJqvoJOCyptukbayF is not None:
            assert rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.parameterization == "eps", 'not implemented'
            uBmQzRLOVgunSnlFcnqpUgJOxetSTMeK = uwmipcScpDsNgboUJqvoJOCyptukbayF.modify_score(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM, uBmQzRLOVgunSnlFcnqpUgJOxetSTMeK, NECAaWUrFGIXcLimrerEYmxYIykQBfXb, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, cjHIelcAqVoHWdLcgzuZiBumKNTVADsY, **svkqejXkhYfQwesKfbROwkTDdoaLEyDR)
        QgAevolFCLuucRhHfnVzUiISHrgGQRYP = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN if KtYiLLkMttRIVWgJPwYdrzrduvlLpeov else rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.QjiFjIOgEuLEafnVNKmbYgjRnHbwNhfp
        PgrClhecyuZcmtDWgocBUxaRljPilBZn = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.xbuEtLNyZNkLwkSOeiFKOKlofYAdfmXP if KtYiLLkMttRIVWgJPwYdrzrduvlLpeov else rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.DaGHMszTvPtphdOZZoBVaYSOdJOBoPWO
        IFcVijiEzGFYdGRIVpuvuNqNwnXpwfVP = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.ayIzJzknKslZlpJwTeDgXUXhvxStZQpi if KtYiLLkMttRIVWgJPwYdrzrduvlLpeov else rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ddim_sqrt_one_minus_alphas
        ywkdEDhpSPXHYARENdFhpYnCzsLhiORy = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.ddim_sigmas_for_original_num_steps if KtYiLLkMttRIVWgJPwYdrzrduvlLpeov else rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.UhwxvNJOIOpYuDYuLFnCTFkDJmQARxHP
        zSEsdYsYRoQzRYuMFNBptmaevaZkAzIb = torch.full((b, 1, 1, 1), QgAevolFCLuucRhHfnVzUiISHrgGQRYP[index], fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc=fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc)
        jUZIwXKcGkMkgbozsGgRVWpoQpuLRXeX = torch.full((b, 1, 1, 1), PgrClhecyuZcmtDWgocBUxaRljPilBZn[index], fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc=fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc)
        zhpCBYkwQkhgdrClReoQrMdATdSZEHOs = torch.full((b, 1, 1, 1), ywkdEDhpSPXHYARENdFhpYnCzsLhiORy[index], fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc=fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc)
        xHUMMKzIYwKrFkonVrNjpjgiLwOrNOGM = torch.full((b, 1, 1, 1), IFcVijiEzGFYdGRIVpuvuNqNwnXpwfVP[index],fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc=fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc)
        if rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.parameterization != "v":
            OFZIJlADjsdMdYLlZlOCATiBMXflBfif = (NECAaWUrFGIXcLimrerEYmxYIykQBfXb - xHUMMKzIYwKrFkonVrNjpjgiLwOrNOGM * uBmQzRLOVgunSnlFcnqpUgJOxetSTMeK) / zSEsdYsYRoQzRYuMFNBptmaevaZkAzIb.sqrt()
        else:
            OFZIJlADjsdMdYLlZlOCATiBMXflBfif = uECnTnBCuBqbDgSNRAiUiBKHNFFLIvnZ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, NECAaWUrFGIXcLimrerEYmxYIykQBfXb.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg) * NECAaWUrFGIXcLimrerEYmxYIykQBfXb - uECnTnBCuBqbDgSNRAiUiBKHNFFLIvnZ(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ayIzJzknKslZlpJwTeDgXUXhvxStZQpi, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, NECAaWUrFGIXcLimrerEYmxYIykQBfXb.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg) * JAGgHAhaDmWtkIWKZFBIaPOFvCpZlupj
        if AQYujjqVWCTYeuoWJTDsAGdUIvWSqQDp:
            OFZIJlADjsdMdYLlZlOCATiBMXflBfif, _, *_ = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.first_stage_model.igozXCsnhgCZQmnoJMlyfcgGnTBaMSfs(OFZIJlADjsdMdYLlZlOCATiBMXflBfif)
        if qrcmQREjMkdBFKktuBhBkKwQXjUbXcKA is not None:
            raise NotImplementedError()
        XxaPiEaRsRiuOHxoRmexVbbHxaCFDzBa = (1. - jUZIwXKcGkMkgbozsGgRVWpoQpuLRXeX - zhpCBYkwQkhgdrClReoQrMdATdSZEHOs**2).sqrt() * uBmQzRLOVgunSnlFcnqpUgJOxetSTMeK
        jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD = zhpCBYkwQkhgdrClReoQrMdATdSZEHOs * LrAizKrQgKBxXFjYQZHueeWsViuvAXJp(NECAaWUrFGIXcLimrerEYmxYIykQBfXb.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg, fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc, ILPiaoThrLFONsZievnjpKpnQSXeiZbN) * bPjNAKUJbfwLGNTyXOwhREwhMbkCGtZT
        if TMglOjqaCnnmFnxLIYsGatkRARSSDlWE > 0.:
            jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD = torch.nn.functional.kcIxGCXrUvsLPSfmGoULGFzAthVmTXcA(jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD, HutkrxeXIuRQKOhCWHkiwqLGAsJjUSKj=TMglOjqaCnnmFnxLIYsGatkRARSSDlWE)
        sIfmGCKFYSuAcKGivnHeSsHXHFOsVWBD = jUZIwXKcGkMkgbozsGgRVWpoQpuLRXeX.sqrt() * OFZIJlADjsdMdYLlZlOCATiBMXflBfif + XxaPiEaRsRiuOHxoRmexVbbHxaCFDzBa + jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD
        return sIfmGCKFYSuAcKGivnHeSsHXHFOsVWBD, OFZIJlADjsdMdYLlZlOCATiBMXflBfif
    @torch.no_grad()
    def encode(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP, cjHIelcAqVoHWdLcgzuZiBumKNTVADsY, t_enc, KtYiLLkMttRIVWgJPwYdrzrduvlLpeov=False, return_intermediates=None,
               dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY=1.0, yBqylnocrhyQcXxvCQFExhNCxzTGzMKi=None, FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF=None):
        MPjAzwMpEXBXRzExELgHCVAszgxvoYMJ = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ddpm_num_timesteps if KtYiLLkMttRIVWgJPwYdrzrduvlLpeov else rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0]
        assert t_enc <= MPjAzwMpEXBXRzExELgHCVAszgxvoYMJ
        WefvdocPmjFndnQUuYmdZKYvUBnqMlwy = t_enc
        if KtYiLLkMttRIVWgJPwYdrzrduvlLpeov:
            sHmxpWQZXiaWFcxtZjUpRDvzLSMNaiqa = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.IOpmYnAWyhIWgvrJQuznNWQMTUXYwThN[:WefvdocPmjFndnQUuYmdZKYvUBnqMlwy]
            QgAevolFCLuucRhHfnVzUiISHrgGQRYP = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xbuEtLNyZNkLwkSOeiFKOKlofYAdfmXP[:WefvdocPmjFndnQUuYmdZKYvUBnqMlwy]
        else:
            sHmxpWQZXiaWFcxtZjUpRDvzLSMNaiqa = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.QjiFjIOgEuLEafnVNKmbYgjRnHbwNhfp[:WefvdocPmjFndnQUuYmdZKYvUBnqMlwy]
            QgAevolFCLuucRhHfnVzUiISHrgGQRYP = torch.xPmCFphFKpGMpIsczaSKHmMgRPZzJwla(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.DaGHMszTvPtphdOZZoBVaYSOdJOBoPWO[:WefvdocPmjFndnQUuYmdZKYvUBnqMlwy])
        WuqcsgREvbPtMPnrptKyDUZPymYjIRwR = UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP
        YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK = []
        CbZpBerJNxJCNRWGROEqDUaqLBkSKaUf = []
        for HCXmerBqIMuTscBONzTGKYapYSxWTYHo in tqdm(range(WefvdocPmjFndnQUuYmdZKYvUBnqMlwy), desc='Encoding Image'):
            XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz = torch.full((UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0],), HCXmerBqIMuTscBONzTGKYapYSxWTYHo, fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc=rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc, DDRQlhrNSGpwTrokWitkZipdfbAqBFxv=torch.long)
            if dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY == 1.:
                cLUigMLPRSzzKBJmtVECAioaXMfrBmfJ = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.MuUKKVVLhPOQUuXCLkPqFOcgOkyciNHd(WuqcsgREvbPtMPnrptKyDUZPymYjIRwR, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, cjHIelcAqVoHWdLcgzuZiBumKNTVADsY)
            else:
                assert yBqylnocrhyQcXxvCQFExhNCxzTGzMKi is not None
                eQxLGgMGfzbpdqlJoqsWEzwuUbagcVaD, cLUigMLPRSzzKBJmtVECAioaXMfrBmfJ = torch.ebMwMGDmpDsmyMtCQfGxUhZuVHvTpavF(
                    rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.VrbJByPOrwLhVLYeJgcqPdGZIrgKHzRM.MuUKKVVLhPOQUuXCLkPqFOcgOkyciNHd(torch.cat((WuqcsgREvbPtMPnrptKyDUZPymYjIRwR, WuqcsgREvbPtMPnrptKyDUZPymYjIRwR)), torch.cat((XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz)),
                                           torch.cat((yBqylnocrhyQcXxvCQFExhNCxzTGzMKi, cjHIelcAqVoHWdLcgzuZiBumKNTVADsY))), 2)
                cLUigMLPRSzzKBJmtVECAioaXMfrBmfJ = eQxLGgMGfzbpdqlJoqsWEzwuUbagcVaD + dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY * (cLUigMLPRSzzKBJmtVECAioaXMfrBmfJ - eQxLGgMGfzbpdqlJoqsWEzwuUbagcVaD)
            YEANUqYROFBGrEHYitgHdaUcUENCYIls = (sHmxpWQZXiaWFcxtZjUpRDvzLSMNaiqa[HCXmerBqIMuTscBONzTGKYapYSxWTYHo] / QgAevolFCLuucRhHfnVzUiISHrgGQRYP[HCXmerBqIMuTscBONzTGKYapYSxWTYHo]).sqrt() * WuqcsgREvbPtMPnrptKyDUZPymYjIRwR
            aQZPhvNKgCwxisCaeOITdMXpObAYUBpZ = sHmxpWQZXiaWFcxtZjUpRDvzLSMNaiqa[HCXmerBqIMuTscBONzTGKYapYSxWTYHo].sqrt() * (
                    (1 / sHmxpWQZXiaWFcxtZjUpRDvzLSMNaiqa[HCXmerBqIMuTscBONzTGKYapYSxWTYHo] - 1).sqrt() - (1 / QgAevolFCLuucRhHfnVzUiISHrgGQRYP[HCXmerBqIMuTscBONzTGKYapYSxWTYHo] - 1).sqrt()) * cLUigMLPRSzzKBJmtVECAioaXMfrBmfJ
            WuqcsgREvbPtMPnrptKyDUZPymYjIRwR = YEANUqYROFBGrEHYitgHdaUcUENCYIls + aQZPhvNKgCwxisCaeOITdMXpObAYUBpZ
            if return_intermediates and HCXmerBqIMuTscBONzTGKYapYSxWTYHo % (
                    WefvdocPmjFndnQUuYmdZKYvUBnqMlwy // return_intermediates) == 0 and HCXmerBqIMuTscBONzTGKYapYSxWTYHo < WefvdocPmjFndnQUuYmdZKYvUBnqMlwy - 1:
                YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK.append(WuqcsgREvbPtMPnrptKyDUZPymYjIRwR)
                CbZpBerJNxJCNRWGROEqDUaqLBkSKaUf.append(HCXmerBqIMuTscBONzTGKYapYSxWTYHo)
            elif return_intermediates and HCXmerBqIMuTscBONzTGKYapYSxWTYHo >= WefvdocPmjFndnQUuYmdZKYvUBnqMlwy - 2:
                YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK.append(WuqcsgREvbPtMPnrptKyDUZPymYjIRwR)
                CbZpBerJNxJCNRWGROEqDUaqLBkSKaUf.append(HCXmerBqIMuTscBONzTGKYapYSxWTYHo)
            if FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF: FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF(HCXmerBqIMuTscBONzTGKYapYSxWTYHo)
        iqymPVpxyjOWChGwBkTemSzHJbnJdAIz = {'x_encoded': WuqcsgREvbPtMPnrptKyDUZPymYjIRwR, 'intermediate_steps': CbZpBerJNxJCNRWGROEqDUaqLBkSKaUf}
        if return_intermediates:
            iqymPVpxyjOWChGwBkTemSzHJbnJdAIz.update({'intermediates': YJbEpRPxEWHFEhbTXWwgTAKwhRHagUOK})
        return WuqcsgREvbPtMPnrptKyDUZPymYjIRwR, iqymPVpxyjOWChGwBkTemSzHJbnJdAIz
    @torch.no_grad()
    def uDSsuhHYwyjeeHXPcJnAfHOaCSQbgMDj(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, KtYiLLkMttRIVWgJPwYdrzrduvlLpeov=False, jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD=None, max_denoise=False):
        if KtYiLLkMttRIVWgJPwYdrzrduvlLpeov:
            mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj
            ayIzJzknKslZlpJwTeDgXUXhvxStZQpi = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ayIzJzknKslZlpJwTeDgXUXhvxStZQpi
        else:
            mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj = torch.sqrt(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.QjiFjIOgEuLEafnVNKmbYgjRnHbwNhfp)
            ayIzJzknKslZlpJwTeDgXUXhvxStZQpi = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ddim_sqrt_one_minus_alphas
        if jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD is None:
            jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD = torch.randn_like(UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP)
        if max_denoise:
            HvYsODPGlWHxeByDNKhhOshIqJIoGZVA = 1.0
        else:
            HvYsODPGlWHxeByDNKhhOshIqJIoGZVA = uECnTnBCuBqbDgSNRAiUiBKHNFFLIvnZ(ayIzJzknKslZlpJwTeDgXUXhvxStZQpi, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg)
        return (uECnTnBCuBqbDgSNRAiUiBKHNFFLIvnZ(mAVBENrpAEAwdlYPnWCSJlpwiHyDQHAj, XCZVXZddKTVHBdAfwJBwCqQTICqPeyUz, UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg) * UBGvtPbFIPlcsBIwyWKuWMZeENGLMRAP + HvYsODPGlWHxeByDNKhhOshIqJIoGZVA * jCizDlbKxNNChDZcMjnDhRYUQUZdrTRD)
    @torch.no_grad()
    def DzeufPfapTAWMrnfPsMZfOIZEyGYmPHT(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS, x_latent, BuoWBAnnMxyvqTGoSTHbQAlvPFWHbuUf, t_start, dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY=1.0, yBqylnocrhyQcXxvCQFExhNCxzTGzMKi=None,
               KtYiLLkMttRIVWgJPwYdrzrduvlLpeov=False, FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF=None):
        iaqNqpReXPEdYpNiyUIejEPLCqtbtedA = np.arange(rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.ddpm_num_timesteps) if KtYiLLkMttRIVWgJPwYdrzrduvlLpeov else rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.xaHdUhZcWVcLrTPEWFnTJjCgaiOMOyDm
        iaqNqpReXPEdYpNiyUIejEPLCqtbtedA = iaqNqpReXPEdYpNiyUIejEPLCqtbtedA[:t_start]
        DlZgArthcSzgtzGqfHDDEnFCHSLHQWRM = np.hAHyMhlDympwYBnEsaNWPsolDQrxyovx(iaqNqpReXPEdYpNiyUIejEPLCqtbtedA)
        TuJjDqKZekSGicNtWVQgPuLDBIQsIxym = iaqNqpReXPEdYpNiyUIejEPLCqtbtedA.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0]
        print(f"Running DDIM Sampling with {total_steps} timesteps")
        OphIfvlLGVjDrByPmOZajfCurTkgSmqc = tqdm(DlZgArthcSzgtzGqfHDDEnFCHSLHQWRM, desc='Decoding image', total=TuJjDqKZekSGicNtWVQgPuLDBIQsIxym)
        HqrvtTuPUbCGWqzJYTaUbFDASLizXiMl = x_latent
        for HCXmerBqIMuTscBONzTGKYapYSxWTYHo, UHmIQCHeLkozPfaktIdEHKdpTVYzCLhe in enumerate(OphIfvlLGVjDrByPmOZajfCurTkgSmqc):
            index = TuJjDqKZekSGicNtWVQgPuLDBIQsIxym - HCXmerBqIMuTscBONzTGKYapYSxWTYHo - 1
            cZfLNeHGLvPreutnrDmWGGyKvtymQVKM = torch.full((x_latent.BElyDvcGzbvMmmwmYRGBIJogcxsyYZSg[0],), UHmIQCHeLkozPfaktIdEHKdpTVYzCLhe, fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc=x_latent.fncUdpUPRXGoRKeawVhmqjlxVPGbdjmc, DDRQlhrNSGpwTrokWitkZipdfbAqBFxv=torch.long)
            HqrvtTuPUbCGWqzJYTaUbFDASLizXiMl, _ = rmBxqCKJkHuPIHNivpdAAgzvrGlNKdVS.iWWXFzGlJRZzfTFBoztQEvdffYEWIlfJ(HqrvtTuPUbCGWqzJYTaUbFDASLizXiMl, BuoWBAnnMxyvqTGoSTHbQAlvPFWHbuUf, cZfLNeHGLvPreutnrDmWGGyKvtymQVKM, index=index, KtYiLLkMttRIVWgJPwYdrzrduvlLpeov=KtYiLLkMttRIVWgJPwYdrzrduvlLpeov,
                                          dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY=dwjsCGpwSsxFQHnTouUTMnLobJXVZRBY,
                                          yBqylnocrhyQcXxvCQFExhNCxzTGzMKi=yBqylnocrhyQcXxvCQFExhNCxzTGzMKi)
            if FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF: FJsaFpOBdvpFlEdxOzBgjwcWBUfetQGF(HCXmerBqIMuTscBONzTGKYapYSxWTYHo)
        return x_dec