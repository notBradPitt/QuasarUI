import os
import time
hZQMFPwtakjynkeurEyZiPAYMqwfPAZc = set(['.ckpt', '.pt', '.bin', '.pth', '.safetensors'])
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG = {}
TkQiWYaXtJuzzefZQkRCbaAzWTYQqpiC = os.paTH.dirname(os.paTH.realpath(__file__))
iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM = os.paTH.join(TkQiWYaXtJuzzefZQkRCbaAzWTYQqpiC, "models")
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["checkpoints"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "checkpoints")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["configs"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "configs")], [".yaml"])
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["loras"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "loras")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["vae"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "vae")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["clip"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "clip")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["unet"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "unet")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["clip_vision"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "clip_vision")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["style_models"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "style_models")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["embeddings"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "embeddings")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["diffusers"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "diffusers")], ["folder"])
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["vae_approx"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "vae_approx")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["controlnet"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "controlnet"), os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "t2i_adapter")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["gligen"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "gligen")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["upscale_models"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "upscale_models")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["custom_nodes"] = ([os.paTH.join(TkQiWYaXtJuzzefZQkRCbaAzWTYQqpiC, "custom_nodes")], [])
RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG["hypernetworks"] = ([os.paTH.join(iTgDKqnzsINaQjOfADlnzvTrjwAMQoHM, "hypernetworks")], hZQMFPwtakjynkeurEyZiPAYMqwfPAZc)
GtSyetIaLksMxiwaHjRuEDPDczomOxfB = os.paTH.join(os.paTH.dirname(os.paTH.realpath(__file__)), "output")
sBxeZEvOLuqHjzzCBAVYRZTjCrezBxCX = os.paTH.join(os.paTH.dirname(os.paTH.realpath(__file__)), "temp")
JVnqMUCDCOqhSclOtgLoQNuaQwivvlwP = os.paTH.join(os.paTH.dirname(os.paTH.realpath(__file__)), "input")
JyZmzIiPwdUaqrBdrvxSwDliHEuoQwXM = {}
if not os.paTH.CzuSRmujwDQnNtuxpiDhURIOWmCdbjjH(JVnqMUCDCOqhSclOtgLoQNuaQwivvlwP):
    os.makedirs(JVnqMUCDCOqhSclOtgLoQNuaQwivvlwP)
def QaqVOGrCQsMzyJzwFXeqRMUkMfnKwrHp(DIUNPQiJKWsgpSdsJVPWmcWtoPKBTsdh):
    global GtSyetIaLksMxiwaHjRuEDPDczomOxfB
    GtSyetIaLksMxiwaHjRuEDPDczomOxfB = DIUNPQiJKWsgpSdsJVPWmcWtoPKBTsdh
def UjFfHXPSSdYnVuSiGnNlPxKKudSjKFNY(CtmzHSDvDEVGVbXeTIhzZgbBXVjSiNhP):
    global sBxeZEvOLuqHjzzCBAVYRZTjCrezBxCX
    sBxeZEvOLuqHjzzCBAVYRZTjCrezBxCX = CtmzHSDvDEVGVbXeTIhzZgbBXVjSiNhP
def gZpMXpjIEjIdWmJXOqOJEBRXYgziLydo():
    global GtSyetIaLksMxiwaHjRuEDPDczomOxfB
    return GtSyetIaLksMxiwaHjRuEDPDczomOxfB
def PlSKGeZYRqtlMHiaBRCToWuXDcNhJEvq():
    global sBxeZEvOLuqHjzzCBAVYRZTjCrezBxCX
    return sBxeZEvOLuqHjzzCBAVYRZTjCrezBxCX
def oLxzopmIeTVwZiWTpRvVAVRpJiaEjmiS():
    global JVnqMUCDCOqhSclOtgLoQNuaQwivvlwP
    return JVnqMUCDCOqhSclOtgLoQNuaQwivvlwP
def kxrHWrKUsAImLcADDJwQctHfTpGpGvug(type_name):
    if type_name == "output":
        return gZpMXpjIEjIdWmJXOqOJEBRXYgziLydo()
    if type_name == "temp":
        return PlSKGeZYRqtlMHiaBRCToWuXDcNhJEvq()
    if type_name == "input":
        return oLxzopmIeTVwZiWTpRvVAVRpJiaEjmiS()
    return None
def ZouPnEJNuptYlYBxNIdTXWRhksIQlBbt(pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ):
    if pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ.endswith("[output]"):
        qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ = gZpMXpjIEjIdWmJXOqOJEBRXYgziLydo()
        pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ = pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ[:-9]
    elif pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ.endswith("[input]"):
        qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ = oLxzopmIeTVwZiWTpRvVAVRpJiaEjmiS()
        pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ = pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ[:-8]
    elif pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ.endswith("[temp]"):
        qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ = PlSKGeZYRqtlMHiaBRCToWuXDcNhJEvq()
        pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ = pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ[:-7]
    else:
        return pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ, None
    return pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ, qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ
def OPtRRiXTVYmRqsnzHEbbUWCzjjPfVhOl(pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ, default_dir=None):
    pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ, qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ = ZouPnEJNuptYlYBxNIdTXWRhksIQlBbt(pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ)
    if qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ is None:
        if default_dir is not None:
            qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ = default_dir
        else:
            qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ = oLxzopmIeTVwZiWTpRvVAVRpJiaEjmiS()  
    return os.paTH.join(qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ, pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ)
def LuEtoKSPwnkgulAqhArQxPlLlkJrpWJM(pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ):
    pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ, qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ = ZouPnEJNuptYlYBxNIdTXWRhksIQlBbt(pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ)
    if qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ is None:
        qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ = oLxzopmIeTVwZiWTpRvVAVRpJiaEjmiS()  
    jGKkchjlDQuvRrYKaTApaOEWXvxjRZoh = os.paTH.join(qQaBpsOaFfJUnrTGkifLbJyCyczdakPQ, pSfJNVvqLWVlUeHdpahCTGSrSPJYAnEQ)
    return os.paTH.CzuSRmujwDQnNtuxpiDhURIOWmCdbjjH(jGKkchjlDQuvRrYKaTApaOEWXvxjRZoh)
def tXboLlrRieKqwPeTtnDtKOeZJiYAGlLt(OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ, full_folder_path):
    global RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG
    if OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ in RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG:
        RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG[OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ][0].append(full_folder_path)
    else:
        RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG[OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ] = ([full_folder_path], set())
def HXYNxZJQjELjaaxuKjoZoxFzWaIvOYmT(OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ):
    return RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG[OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ][0][:]
def obGgHnWHZHxVqLnvnUwXaOsmgUVmduqj(directory, hycpXyDmpuOeQeuwvqXUjhiJtDOFTONs=None):
    if not os.paTH.isdir(directory):
        return [], {}
    if hycpXyDmpuOeQeuwvqXUjhiJtDOFTONs is None:
        hycpXyDmpuOeQeuwvqXUjhiJtDOFTONs = []
    EpPkhmvnuPCNYOnbTkWPbRocxmdOwtHI = []
    tMqhONnNTXdwHJmOQatOuImsYofVgJxi = {directory: os.paTH.getmtime(directory)}
    for XCrmLuQijIRiBbHWvECkfaKyKAGmZfFW, fCAMhpfBWcaJjstQXXJyoBiwKjkwqxdP, mkvCrqyejrekyuWxgtHkShApwhhCDyMu in os.walk(directory, followlinks=True, topdown=True):
        fCAMhpfBWcaJjstQXXJyoBiwKjkwqxdP[:] = [TXGwYXNLgQsYzfHHpRBDJGFCFZEClzIo for TXGwYXNLgQsYzfHHpRBDJGFCFZEClzIo in fCAMhpfBWcaJjstQXXJyoBiwKjkwqxdP if TXGwYXNLgQsYzfHHpRBDJGFCFZEClzIo not in hycpXyDmpuOeQeuwvqXUjhiJtDOFTONs]
        for cUwDjpDYeDLcRutcYgVbXhXpxYeYFdHt in mkvCrqyejrekyuWxgtHkShApwhhCDyMu:
            qNWMfFLBJiRgAvaCCCCahKsWaeudkTaD = os.paTH.relpath(os.paTH.join(XCrmLuQijIRiBbHWvECkfaKyKAGmZfFW, cUwDjpDYeDLcRutcYgVbXhXpxYeYFdHt), directory)
            EpPkhmvnuPCNYOnbTkWPbRocxmdOwtHI.append(qNWMfFLBJiRgAvaCCCCahKsWaeudkTaD)
        for TXGwYXNLgQsYzfHHpRBDJGFCFZEClzIo in fCAMhpfBWcaJjstQXXJyoBiwKjkwqxdP:
            paTH = os.paTH.join(XCrmLuQijIRiBbHWvECkfaKyKAGmZfFW, TXGwYXNLgQsYzfHHpRBDJGFCFZEClzIo)
            tMqhONnNTXdwHJmOQatOuImsYofVgJxi[paTH] = os.paTH.getmtime(paTH)
    return EpPkhmvnuPCNYOnbTkWPbRocxmdOwtHI, tMqhONnNTXdwHJmOQatOuImsYofVgJxi
def ogrHHnnoHaDAeFerfHoOKjouTxChktKm(DTcHrFlDIwbrZDZHTOmAOTxRFqptCgyE, HnjgYzcYVPzWBFjtnXmWmmBUkGpTxjgv):
    return sorted(list(filter(lambda GlZreLQjBCiBptpFgmbsMbhjFlMgPVav: os.paTH.splitext(GlZreLQjBCiBptpFgmbsMbhjFlMgPVav)[-1].lower() in HnjgYzcYVPzWBFjtnXmWmmBUkGpTxjgv, DTcHrFlDIwbrZDZHTOmAOTxRFqptCgyE)))
def TIUEGMgxYSpXjfhmEGzFnNfGAqtlBBKE(OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ, VpsbOZzufynrTFUvvRofTQeRCOCIKJOM):
    global RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG
    if OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ not in RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG:
        return None
    LjTAnyqWGFlIaOwfqQTfGKbkmjrAjQnu = RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG[OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ]
    VpsbOZzufynrTFUvvRofTQeRCOCIKJOM = os.paTH.relpath(os.paTH.join("/", VpsbOZzufynrTFUvvRofTQeRCOCIKJOM), "/")
    for NECAaWUrFGIXcLimrerEYmxYIykQBfXb in LjTAnyqWGFlIaOwfqQTfGKbkmjrAjQnu[0]:
        BvZbFoQIcgYmFXROwptYbIKgzYJORrYY = os.paTH.join(NECAaWUrFGIXcLimrerEYmxYIykQBfXb, VpsbOZzufynrTFUvvRofTQeRCOCIKJOM)
        if os.paTH.isfile(BvZbFoQIcgYmFXROwptYbIKgzYJORrYY):
            return BvZbFoQIcgYmFXROwptYbIKgzYJORrYY
    return None
def wZITfTxkrUGlgkNhyVkQeGQnBOOGviUn(OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ):
    global RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG
    GgpaBLoBmoIhHNvNAUUHscrTPvveyTGt = set()
    LjTAnyqWGFlIaOwfqQTfGKbkmjrAjQnu = RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG[OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ]
    MeRskWbjCfHyBXapOnnGcEMlMZxTeiIR = {}
    for NECAaWUrFGIXcLimrerEYmxYIykQBfXb in LjTAnyqWGFlIaOwfqQTfGKbkmjrAjQnu[0]:
        DTcHrFlDIwbrZDZHTOmAOTxRFqptCgyE, ZBGyBxxmhCoTmaItLhabPXHZIdhzfXYB = obGgHnWHZHxVqLnvnUwXaOsmgUVmduqj(NECAaWUrFGIXcLimrerEYmxYIykQBfXb, hycpXyDmpuOeQeuwvqXUjhiJtDOFTONs=[".git"])
        GgpaBLoBmoIhHNvNAUUHscrTPvveyTGt.update(ogrHHnnoHaDAeFerfHoOKjouTxChktKm(DTcHrFlDIwbrZDZHTOmAOTxRFqptCgyE, LjTAnyqWGFlIaOwfqQTfGKbkmjrAjQnu[1]))
        MeRskWbjCfHyBXapOnnGcEMlMZxTeiIR = {**MeRskWbjCfHyBXapOnnGcEMlMZxTeiIR, **ZBGyBxxmhCoTmaItLhabPXHZIdhzfXYB}
    return (sorted(list(GgpaBLoBmoIhHNvNAUUHscrTPvveyTGt)), MeRskWbjCfHyBXapOnnGcEMlMZxTeiIR, time.perf_counter())
def cbzhDWvXQBiEgEVdjzZaBlkWnnmGvfgj(OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ):
    global JyZmzIiPwdUaqrBdrvxSwDliHEuoQwXM
    global RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG
    if OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ not in JyZmzIiPwdUaqrBdrvxSwDliHEuoQwXM:
        return None
    iqymPVpxyjOWChGwBkTemSzHJbnJdAIz = JyZmzIiPwdUaqrBdrvxSwDliHEuoQwXM[OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ]
    if time.perf_counter() < (iqymPVpxyjOWChGwBkTemSzHJbnJdAIz[2] + 0.5):
        return iqymPVpxyjOWChGwBkTemSzHJbnJdAIz
    for NECAaWUrFGIXcLimrerEYmxYIykQBfXb in iqymPVpxyjOWChGwBkTemSzHJbnJdAIz[1]:
        ufReozYqFDHrDJiiCgVhHqnMnsesjFSb = iqymPVpxyjOWChGwBkTemSzHJbnJdAIz[1][NECAaWUrFGIXcLimrerEYmxYIykQBfXb]
        OwJCTJVwyMUEtfjtMzVQMjEELeqLNhyX = NECAaWUrFGIXcLimrerEYmxYIykQBfXb
        if os.paTH.getmtime(OwJCTJVwyMUEtfjtMzVQMjEELeqLNhyX) != ufReozYqFDHrDJiiCgVhHqnMnsesjFSb:
            return None
    LjTAnyqWGFlIaOwfqQTfGKbkmjrAjQnu = RtqMYVjkHvPjjwaAjZzZiDKOhSnoAwQG[OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ]
    for NECAaWUrFGIXcLimrerEYmxYIykQBfXb in LjTAnyqWGFlIaOwfqQTfGKbkmjrAjQnu[0]:
        if os.paTH.isdir(NECAaWUrFGIXcLimrerEYmxYIykQBfXb):
            if NECAaWUrFGIXcLimrerEYmxYIykQBfXb not in iqymPVpxyjOWChGwBkTemSzHJbnJdAIz[1]:
                return None
    return iqymPVpxyjOWChGwBkTemSzHJbnJdAIz
def DYvodbeLLCWlQGasCGeYTFNFKZRpPvmd(OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ):
    iqymPVpxyjOWChGwBkTemSzHJbnJdAIz = cbzhDWvXQBiEgEVdjzZaBlkWnnmGvfgj(OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ)
    if iqymPVpxyjOWChGwBkTemSzHJbnJdAIz is None:
        iqymPVpxyjOWChGwBkTemSzHJbnJdAIz = wZITfTxkrUGlgkNhyVkQeGQnBOOGviUn(OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ)
        global JyZmzIiPwdUaqrBdrvxSwDliHEuoQwXM
        JyZmzIiPwdUaqrBdrvxSwDliHEuoQwXM[OiSDAWttaBayZhaRXvjSPjBrXgoDRtfZ] = iqymPVpxyjOWChGwBkTemSzHJbnJdAIz
    return list(iqymPVpxyjOWChGwBkTemSzHJbnJdAIz[0])
def RzAZobMvYWLmMtiqbeSollhpzISOJhWp(azafsUqgjjnMJDTDVblsTwqgMmfrAEPm, DIUNPQiJKWsgpSdsJVPWmcWtoPKBTsdh, image_width=0, image_height=0):
    def kvXDIOWWdUPJRythbyaKVomFIZtNHPIf(VpsbOZzufynrTFUvvRofTQeRCOCIKJOM):
        EHPJUgMmqUaZlktbaRCBTfLvSXvWOHtL = len(os.paTH.basename(azafsUqgjjnMJDTDVblsTwqgMmfrAEPm))
        mAocOLWlgMJvPYVmSRndfhQdAcKHgPwi = VpsbOZzufynrTFUvvRofTQeRCOCIKJOM[:EHPJUgMmqUaZlktbaRCBTfLvSXvWOHtL + 1]
        try:
            hCVGAfCArAJbgwQyBsUtCdmTkaFHlUwI = int(VpsbOZzufynrTFUvvRofTQeRCOCIKJOM[EHPJUgMmqUaZlktbaRCBTfLvSXvWOHtL + 1:].split('_')[0])
        except:
            hCVGAfCArAJbgwQyBsUtCdmTkaFHlUwI = 0
        return (hCVGAfCArAJbgwQyBsUtCdmTkaFHlUwI, mAocOLWlgMJvPYVmSRndfhQdAcKHgPwi)
    def UWfTdcFvxzbgLumqlxvZmrHJBBJcgAIR(input, image_width, image_height):
        input = input.replace("%width%", str(image_width))
        input = input.replace("%height%", str(image_height))
        return input
    azafsUqgjjnMJDTDVblsTwqgMmfrAEPm = UWfTdcFvxzbgLumqlxvZmrHJBBJcgAIR(azafsUqgjjnMJDTDVblsTwqgMmfrAEPm, image_width, image_height)
    EijzAwkTdadIdbBCcDEUbEYNNcstskwi = os.paTH.dirname(os.paTH.normpath(azafsUqgjjnMJDTDVblsTwqgMmfrAEPm))
    VpsbOZzufynrTFUvvRofTQeRCOCIKJOM = os.paTH.basename(os.paTH.normpath(azafsUqgjjnMJDTDVblsTwqgMmfrAEPm))
    NSnmtWjKbAQhROMkmRknqzSaUCojgOin = os.paTH.join(DIUNPQiJKWsgpSdsJVPWmcWtoPKBTsdh, EijzAwkTdadIdbBCcDEUbEYNNcstskwi)
    if os.paTH.commonpath((DIUNPQiJKWsgpSdsJVPWmcWtoPKBTsdh, os.paTH.abspath(NSnmtWjKbAQhROMkmRknqzSaUCojgOin))) != DIUNPQiJKWsgpSdsJVPWmcWtoPKBTsdh:
        print("Saving image outside the output folder is not allowed.")
        return {}
    try:
        etmXhuRDTfPuCYAlpkCmiMFiODmDHghZ = max(filter(lambda GlZreLQjBCiBptpFgmbsMbhjFlMgPVav: GlZreLQjBCiBptpFgmbsMbhjFlMgPVav[1][:-1] == VpsbOZzufynrTFUvvRofTQeRCOCIKJOM and GlZreLQjBCiBptpFgmbsMbhjFlMgPVav[1][-1] == "_", map(kvXDIOWWdUPJRythbyaKVomFIZtNHPIf, os.listdir(NSnmtWjKbAQhROMkmRknqzSaUCojgOin))))[0] + 1
    except ValueError:
        etmXhuRDTfPuCYAlpkCmiMFiODmDHghZ = 1
    except FileNotFoundError:
        os.makedirs(NSnmtWjKbAQhROMkmRknqzSaUCojgOin, exist_ok=True)
        etmXhuRDTfPuCYAlpkCmiMFiODmDHghZ = 1
    return NSnmtWjKbAQhROMkmRknqzSaUCojgOin, VpsbOZzufynrTFUvvRofTQeRCOCIKJOM, etmXhuRDTfPuCYAlpkCmiMFiODmDHghZ, EijzAwkTdadIdbBCcDEUbEYNNcstskwi, azafsUqgjjnMJDTDVblsTwqgMmfrAEPm
